<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Currency Converter &mdash; Fintech Portfolio</title>
  <style>
    /* Perplexity Design System */
    :root {
  /* Primitive Color Tokens */
  --color-white: rgba(255, 255, 255, 1);
  --color-black: rgba(0, 0, 0, 1);
  --color-cream-50: rgba(252, 252, 249, 1);
  --color-cream-100: rgba(255, 255, 253, 1);
  --color-gray-200: rgba(245, 245, 245, 1);
  --color-gray-300: rgba(167, 169, 169, 1);
  --color-gray-400: rgba(119, 124, 124, 1);
  --color-slate-500: rgba(98, 108, 113, 1);
  --color-brown-600: rgba(94, 82, 64, 1);
  --color-charcoal-700: rgba(31, 33, 33, 1);
  --color-charcoal-800: rgba(38, 40, 40, 1);
  --color-slate-900: rgba(19, 52, 59, 1);
  --color-teal-300: rgba(50, 184, 198, 1);
  --color-teal-400: rgba(45, 166, 178, 1);
  --color-teal-500: rgba(33, 128, 141, 1);
  --color-teal-600: rgba(29, 116, 128, 1);
  --color-teal-700: rgba(26, 104, 115, 1);
  --color-teal-800: rgba(41, 150, 161, 1);
  --color-red-400: rgba(255, 84, 89, 1);
  --color-red-500: rgba(192, 21, 47, 1);
  --color-orange-400: rgba(230, 129, 97, 1);
  --color-orange-500: rgba(168, 75, 47, 1);

  /* RGB versions for opacity control */
  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;
  --color-slate-500-rgb: 98, 108, 113;
  --color-red-500-rgb: 192, 21, 47;
  --color-red-400-rgb: 255, 84, 89;
  --color-orange-500-rgb: 168, 75, 47;
  --color-orange-400-rgb: 230, 129, 97;

  /* Background color tokens (Light Mode) */
  --color-bg-1: rgba(59, 130, 246, 0.08);
  --color-bg-2: rgba(245, 158, 11, 0.08);
  --color-bg-3: rgba(34, 197, 94, 0.08);
  --color-bg-4: rgba(239, 68, 68, 0.08);
  --color-bg-5: rgba(147, 51, 234, 0.08);
  --color-bg-6: rgba(249, 115, 22, 0.08);
  --color-bg-7: rgba(236, 72, 153, 0.08);
  --color-bg-8: rgba(6, 182, 212, 0.08);

  /* Semantic Color Tokens (Light Mode) */
  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-primary-active: var(--color-teal-700);
  --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
  --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
  --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);
  --color-btn-primary-text: var(--color-cream-50);
  --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
  --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
  --color-error: var(--color-red-500);
  --color-success: var(--color-teal-500);
  --color-warning: var(--color-orange-500);
  --color-info: var(--color-slate-500);
  --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
  --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);

  /* Common style patterns */
  --focus-ring: 0 0 0 3px var(--color-focus-ring);
  --focus-outline: 2px solid var(--color-primary);
  --status-bg-opacity: 0.15;
  --status-border-opacity: 0.25;

  /* RGB versions for opacity control */
  --color-success-rgb: 33, 128, 141;
  --color-error-rgb: 192, 21, 47;
  --color-warning-rgb: 168, 75, 47;
  --color-info-rgb: 98, 108, 113;

  /* Typography */
  --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system,
    BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-family-mono: "Berkeley Mono", ui-monospace, SFMono-Regular, Menlo,
    Monaco, Consolas, monospace;
  --font-size-xs: 11px;
  --font-size-sm: 12px;
  --font-size-base: 14px;
  --font-size-md: 14px;
  --font-size-lg: 16px;
  --font-size-xl: 18px;
  --font-size-2xl: 20px;
  --font-size-3xl: 24px;
  --font-size-4xl: 30px;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 550;
  --font-weight-bold: 600;
  --line-height-tight: 1.2;
  --line-height-normal: 1.5;
  --letter-spacing-tight: -0.01em;

  /* Spacing */
  --space-0: 0;
  --space-1: 1px;
  --space-2: 2px;
  --space-4: 4px;
  --space-6: 6px;
  --space-8: 8px;
  --space-10: 10px;
  --space-12: 12px;
  --space-16: 16px;
  --space-20: 20px;
  --space-24: 24px;
  --space-32: 32px;

  /* Border Radius */
  --radius-sm: 6px;
  --radius-base: 8px;
  --radius-md: 10px;
  --radius-lg: 12px;
  --radius-full: 9999px;

  /* Shadows */
  --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04),
    0 2px 4px -1px rgba(0, 0, 0, 0.02);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04),
    0 4px 6px -2px rgba(0, 0, 0, 0.02);
  --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.15),
    inset 0 -1px 0 rgba(0, 0, 0, 0.03);

  /* Animation */
  --duration-fast: 150ms;
  --duration-normal: 250ms;
  --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);

  /* Layout */
  --container-sm: 640px;
  --container-md: 768px;
  --container-lg: 1024px;
  --container-xl: 1280px;
}

/* Dark mode colors */
@media (prefers-color-scheme: dark) {
  :root {
    --color-gray-400-rgb: 119, 124, 124;
    --color-teal-300-rgb: 50, 184, 198;
    --color-gray-300-rgb: 167, 169, 169;
    --color-gray-200-rgb: 245, 245, 245;

    /* Background color tokens (Dark Mode) */
    --color-bg-1: rgba(29, 78, 216, 0.15);
    --color-bg-2: rgba(180, 83, 9, 0.15);
    --color-bg-3: rgba(21, 128, 61, 0.15);
    --color-bg-4: rgba(185, 28, 28, 0.15);
    --color-bg-5: rgba(107, 33, 168, 0.15);
    --color-bg-6: rgba(194, 65, 12, 0.15);
    --color-bg-7: rgba(190, 24, 93, 0.15);
    --color-bg-8: rgba(8, 145, 178, 0.15);

    /* Semantic Color Tokens (Dark Mode) */
    --color-background: var(--color-charcoal-700);
    --color-surface: var(--color-charcoal-800);
    --color-text: var(--color-gray-200);
    --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
    --color-primary: var(--color-teal-300);
    --color-primary-hover: var(--color-teal-400);
    --color-primary-active: var(--color-teal-800);
    --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
    --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
    --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
    --color-border: rgba(var(--color-gray-400-rgb), 0.3);
    --color-error: var(--color-red-400);
    --color-success: var(--color-teal-300);
    --color-warning: var(--color-orange-400);
    --color-info: var(--color-gray-300);
    --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
    --color-btn-primary-text: var(--color-slate-900);
    --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
    --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
    --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.1),
      inset 0 -1px 0 rgba(0, 0, 0, 0.15);
    --color-select-caret: rgba(var(--color-gray-200-rgb), 0.8);

    /* RGB versions for dark mode */
    --color-success-rgb: var(--color-teal-300-rgb);
    --color-error-rgb: var(--color-red-400-rgb);
    --color-warning-rgb: var(--color-orange-400-rgb);
    --color-info-rgb: var(--color-gray-300-rgb);
  }
}

@font-face {
  font-family: 'FKGroteskNeue';
  src: url('https://r2cdn.perplexity.ai/fonts/FKGroteskNeue.woff2')
    format('woff2');
}

html {
  font-size: var(--font-size-base);
  font-family: var(--font-family-base);
  line-height: var(--line-height-normal);
  color: var(--color-text);
  background-color: var(--color-background);
  -webkit-font-smoothing: antialiased;
  box-sizing: border-box;
}

body {
  margin: 0;
  padding: 0;
}

*,
*::before,
*::after {
  box-sizing: inherit;
}

h1, h2, h3, h4, h5, h6 {
  margin: 0;
  font-weight: var(--font-weight-semibold);
  line-height: var(--line-height-tight);
  color: var(--color-text);
  letter-spacing: var(--letter-spacing-tight);
}

input, select, textarea, button {
  font-family: inherit;
}

.form-control {
  display: block;
  width: 100%;
  padding: var(--space-8) var(--space-12);
  font-size: var(--font-size-md);
  line-height: 1.5;
  color: var(--color-text);
  background-color: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  transition: border-color var(--duration-fast) var(--ease-standard),
    box-shadow var(--duration-fast) var(--ease-standard);
}

.form-control:focus {
  border-color: var(--color-primary);
  outline: var(--focus-outline);
}

.form-label {
  display: block;
  margin-bottom: var(--space-8);
  font-weight: var(--font-weight-medium);
  font-size: var(--font-size-sm);
}
    /* Currency Converter Custom Styles */
    body {
      background: var(--color-background);
      min-height: 100vh;
      padding: 0;
    }
    .currency-converter-app {
      max-width: 420px;
      margin: 40px auto 0 auto;
      padding: var(--space-24);
      background: var(--color-surface);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      display: flex;
      flex-direction: column;
      gap: var(--space-24);
    }
    @media (max-width: 650px) {
      .currency-converter-app { max-width: 98vw; padding: var(--space-8); }
    }
    .ccv-section {
      display: flex; flex-direction: column; gap: var(--space-16); }
    .ccv-inputs-row {
      display: flex; gap: var(--space-8); align-items: flex-end; }
    .ccv-amount {
      flex: 2;
    }
    .ccv-currency {
      flex: 1;
    }
    .ccv-result-card {
      padding: var(--space-20) var(--space-16);
      border-radius: var(--radius-lg);
      background: var(--color-bg-1);
      box-shadow: var(--shadow-sm);
      min-height: 80px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .ccv-result-main {
      font-size: var(--font-size-4xl);
      font-weight: var(--font-weight-bold);
      color: var(--color-primary);
      line-height: 1.3;
      letter-spacing: 0.01em;
      display: flex;
      align-items: flex-end;
    }
    .ccv-result-main .flag {
      margin-left: var(--space-8);
      font-size: 2rem;
      vertical-align: -0.2em;
    }
    .ccv-exchange-row {
      display: flex;
      align-items: center;
      gap: var(--space-8);
      justify-content: center;
      font-size: var(--font-size-lg);
      color: var(--color-text-secondary);
      letter-spacing: 0.01em;
    }
    .ccv-swap-btn {
      background: var(--color-secondary);
      border: none;
      border-radius: var(--radius-full);
      width: 38px; height: 38px;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: background var(--duration-fast) var(--ease-standard), transform 120ms;
      font-size: 1.5rem;
      margin: 0 var(--space-2);
    }
    .ccv-swap-btn:active {
      background: var(--color-primary-hover);
      transform: rotate(90deg);
    }
    .ccv-select-currency {
      width: 100%;
      display: flex; align-items: center;
      gap: var(--space-4);
      font-size: var(--font-size-lg);
    }
    .ccv-currency-flag { font-size: 1.09em; vertical-align: -0.2em; margin-right: var(--space-4); }
    .ccv-rate-row {
      text-align: center;
      color: var(--color-text-secondary);
      font-size: var(--font-size-base);
      display: flex; gap: var(--space-8); align-items: baseline;
      justify-content: center;
    }
    .ccv-rate-timestamp { font-size: var(--font-size-xs); color: var(--color-text-secondary); margin-left: var(--space-8); }
    .ccv-copy-btn {
      background: var(--color-secondary);
      border: none;
      border-radius: var(--radius-full);
      padding: var(--space-4) var(--space-8);
      margin-left: var(--space-8);
      cursor: pointer;
      font-size: var(--font-size-base);
      color: var(--color-primary);
      display: inline-flex;
      align-items: center;
      transition: background var(--duration-fast) var(--ease-standard);
    }
    .ccv-copy-btn:active { background: var(--color-primary-hover); color: var(--color-btn-primary-text); }
    .ccv-loading-spin {
      border: 3px solid var(--color-bg-3);
      border-top: 3px solid var(--color-primary);
      border-radius: 50%;
      width: 26px; height: 26px;
      animation: spin 0.65s linear infinite;
      margin: 0 auto;
    }
    @keyframes spin { 100% { transform: rotate(360deg);} }
    .ccv-history-section {
      margin-top: var(--space-8);
      border-top: 1px solid var(--color-border);
      padding-top: var(--space-16);
      display: flex;
      flex-direction: column;
      gap: var(--space-8);
    }
    .ccv-history-header {
      display: flex; align-items: center; justify-content: space-between;
      font-size: var(--font-size-md);
      font-weight: var(--font-weight-semibold);
    }
    .ccv-history-list {
      display: flex; flex-direction: column; gap: var(--space-8); width: 100%;
    }
    .ccv-history-item {
      display: grid;
      grid-template-columns: 1.3fr 2fr 2fr 2.2fr 2fr;
      align-items: center;
      background: var(--color-bg-2);
      border-radius: var(--radius-base);
      padding: var(--space-8) var(--space-8);
      font-size: var(--font-size-sm);
      cursor: pointer;
      transition: background var(--duration-normal) var(--ease-standard);
    }
    .ccv-history-item:active {
      background: var(--color-bg-4);
    }
    .ccv-history-list .ccv-history-label {
      font-size: var(--font-size-xs);
      color: var(--color-text-secondary);
      background: none;
      font-weight: var(--font-weight-medium);
      text-align: left;
      border: none;
      cursor: default;
      padding: 0;
    }
    .ccv-history-clear {
      color: var(--color-error);
      background: none;
      border: none;
      padding: var(--space-4) var(--space-8);
      cursor: pointer;
      font-size: var(--font-size-sm);
      border-radius: var(--radius-md);
      transition: background var(--duration-fast) var(--ease-standard);
    }
    .ccv-history-clear:active { background: var(--color-bg-4); }
    @media (max-width: 600px) {
      .currency-converter-app { max-width: none; margin: var(--space-8); }
      .ccv-history-item {
        grid-template-columns: 1.5fr 2fr 2fr 2.2fr;
        font-size: var(--font-size-xs);
        padding: var(--space-4) var(--space-4);
      }
    }
  </style>
</head>
<body>
  <main>
    <div class="currency-converter-app" id="ccv-app">
      <!-- Top Inputs Section -->
      <section class="ccv-section" aria-labelledby="ccv-heading">
        <h1 id="ccv-heading" style="font-size:1.4em; text-align:center">Currency Converter</h1>
        <div class="ccv-inputs-row">
          <div class="ccv-amount">
            <label for="ccv-amount-input" class="form-label">Amount</label>
            <input id="ccv-amount-input" class="form-control" inputmode="decimal" type="number" min="0" step="0.01" value="1" aria-label="Amount" autocomplete="off" />
          </div>
          <div class="ccv-currency">
            <label for="ccv-from-currency" class="form-label">From</label>
            <div class="ccv-select-currency">
              <span id="ccv-from-flag" class="ccv-currency-flag">ðŸ‡ºðŸ‡¸</span>
              <select id="ccv-from-currency" class="form-control" aria-label="From currency"></select>
            </div>
          </div>
        </div>
      </section>
      <!-- Result + To Section -->
      <section class="ccv-section" aria-label="Conversion Result and To currency">
        <div class="ccv-result-card" id="ccv-result-card">
          <div id="ccv-loading" class="ccv-loading-spin" style="display:none;"></div>
          <span id="ccv-result-main" class="ccv-result-main">
            <!-- Result rendering here -->
            0.92&nbsp;<span id="ccv-to-symbol">â‚¬</span>
            <span id="ccv-to-flag" class="flag">ðŸ‡ªðŸ‡º</span>
          </span>
        </div>
        <div class="ccv-exchange-row">
          <div class="ccv-rate-row" id="ccv-rate-row"></div>
          <button id="ccv-copy-btn" class="ccv-copy-btn" title="Copy result to clipboard" aria-label="Copy result"><svg width="18" height="18" aria-hidden="true" viewBox="0 0 16 16" fill="none"><rect x="3.5" y="3.5" width="9" height="9" rx="2.5" stroke="currentColor"/><path d="M2.5 6V4A1.5 1.5 0 0 1 4 2.5h2" stroke="currentColor" stroke-linecap="round"/></svg></button>
        </div>
        <div class="ccv-exchange-row">
          <button id="ccv-swap-btn" class="ccv-swap-btn" title="Swap currencies" aria-label="Swap currencies"><svg width="22" height="22" aria-hidden="true" viewBox="0 0 22 22"><path d="M7 7h12M19 7l-3-3m3 3l-3 3M15 15H3m0 0 3-3m-3 3 3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
          <div class="ccv-currency" style="flex: none; width: 130px;">
            <label for="ccv-to-currency" class="form-label">To</label>
            <div class="ccv-select-currency">
              <span id="ccv-to-flag-select" class="ccv-currency-flag">ðŸ‡ªðŸ‡º</span>
              <select id="ccv-to-currency" class="form-control" aria-label="To currency"></select>
            </div>
          </div>
        </div>
      </section>
      <!-- History Section -->
      <section class="ccv-history-section" aria-label="Conversion History">
        <div class="ccv-history-header">
          <span>Conversion History</span>
          <button id="ccv-history-clear" class="ccv-history-clear" aria-label="Clear history">Clear</button>
        </div>
        <div class="ccv-history-list" id="ccv-history-list">
          <div class="ccv-history-item ccv-history-label" role="presentation">
            <div>Amount</div>
            <div>From</div>
            <div>To</div>
            <div>Result</div>
            <div style="font-size:11px; text-align:right;">Time</div>
          </div>
          <!-- History items rendered here -->
        </div>
      </section>
    </div>
  </main>
  <script>
    // --- Static currency data with flags ---
    const CCV_CURRENCIES = {
      USD: { name: "United States Dollar", flag: "ðŸ‡ºðŸ‡¸", symbol: "$", rate: 1.0 },
      EUR: { name: "Euro", flag: "ðŸ‡ªðŸ‡º", symbol: "â‚¬", rate: 0.92 },
      GBP: { name: "British Pound", flag: "ðŸ‡¬ðŸ‡§", symbol: "Â£", rate: 0.79 },
      JPY: { name: "Japanese Yen", flag: "ðŸ‡¯ðŸ‡µ", symbol: "Â¥", rate: 149.50 },
      CHF: { name: "Swiss Franc", flag: "ðŸ‡¨ðŸ‡­", symbol: "CHF", rate: 0.88 },
      CAD: { name: "Canadian Dollar", flag: "ðŸ‡¨ðŸ‡¦", symbol: "C$", rate: 1.37 },
      AUD: { name: "Australian Dollar", flag: "ðŸ‡¦ðŸ‡º", symbol: "A$", rate: 1.54 },
      CNY: { name: "Chinese Yuan", flag: "ðŸ‡¨ðŸ‡³", symbol: "Â¥", rate: 7.24 },
      INR: { name: "Indian Rupee", flag: "ðŸ‡®ðŸ‡³", symbol: "â‚¹", rate: 83.12 },
      KRW: { name: "South Korean Won", flag: "ðŸ‡°ðŸ‡·", symbol: "â‚©", rate: 1297.50 },
      MXN: { name: "Mexican Peso", flag: "ðŸ‡²ðŸ‡½", symbol: "$", rate: 17.05 },
      BRL: { name: "Brazilian Real", flag: "ðŸ‡§ðŸ‡·", symbol: "R$", rate: 4.97 },
      SGD: { name: "Singapore Dollar", flag: "ðŸ‡¸ðŸ‡¬", symbol: "S$", rate: 1.34 },
      HKD: { name: "Hong Kong Dollar", flag: "ðŸ‡­ðŸ‡°", symbol: "HK$", rate: 7.78 },
      SEK: { name: "Swedish Krona", flag: "ðŸ‡¸ðŸ‡ª", symbol: "kr", rate: 10.85 },
    };
    const CCV_ORDER = [
      "USD","EUR","GBP","JPY","CHF","CAD","AUD","CNY","INR","KRW","MXN","BRL","SGD","HKD","SEK"
    ];
    // --- UI references ---
    const elAmount = document.getElementById('ccv-amount-input');
    const elFrom = document.getElementById('ccv-from-currency');
    const elTo = document.getElementById('ccv-to-currency');
    const elFromFlag = document.getElementById('ccv-from-flag');
    const elToFlag = document.getElementById('ccv-to-flag');
    const elToFlagSelect = document.getElementById('ccv-to-flag-select');
    const elResultMain = document.getElementById('ccv-result-main');
    const elResultCard = document.getElementById('ccv-result-card');
    const elRateRow = document.getElementById('ccv-rate-row');
    const elSwap = document.getElementById('ccv-swap-btn');
    const elHistory = document.getElementById('ccv-history-list');
    const elHistoryClear = document.getElementById('ccv-history-clear');
    const elLoading = document.getElementById('ccv-loading');
    const elCopyBtn = document.getElementById('ccv-copy-btn');
    const elToSymbol = document.getElementById('ccv-to-symbol');

    // --- App State ---
    let state = {
      from: 'USD',
      to: 'EUR',
      amount: 1,
      result: null,
      rate: null,
      lastUpdated: null,
      loading: false,
      history: [], // {amount, from, to, result, timestamp}
    };
    function getNowTimestamp() {
      const d = new Date();
      // ISO 8601: without ms, local time
      return d.toLocaleString(undefined, {hour12:false});
    }
    // --- Utility: Number format with 2 decimals, thousand sep ---
    const fmt = new Intl.NumberFormat(undefined, {minimumFractionDigits:2, maximumFractionDigits:2});
    // --- Populate currency selects ---
    function renderCurrencySelect(sel, value, onChange, withFlags) {
      sel.innerHTML = '';
      CCV_ORDER.forEach(cur => {
        const meta = CCV_CURRENCIES[cur];
        const opt = document.createElement('option');
        opt.value = cur;
        opt.textContent = `${withFlags ? meta.flag+ ' ' : ''}${cur} (${meta.symbol})`;
        sel.appendChild(opt);
      });
      sel.value = value;
      sel.onchange = onChange;
    }
    function updateFlags() {
      elFromFlag.textContent = CCV_CURRENCIES[state.from].flag;
      elToFlag.textContent = CCV_CURRENCIES[state.to].flag;
      elToFlagSelect.textContent = CCV_CURRENCIES[state.to].flag;
      elToSymbol.textContent = CCV_CURRENCIES[state.to].symbol;
    }
    // --- Conversion Logic ---
    function getRate(from, to) {
      // convert from base USD to from, then to USD again, then to TO
      const usd = CCV_CURRENCIES[from].rate;
      const tousd = state.from==='USD' ? 1 : 1/usd;
      const toRate = CCV_CURRENCIES[to].rate;
      // For USD->EUR is 1 * 0.92, EUR->USD is 1 / 0.92
      return from === 'USD' ? toRate : (toRate / usd);
    }
    function doConvert({ showLoader=true, recordHistory=true } = {}) {
      let amount = parseFloat(elAmount.value.replace(/,/g,''));
      if (isNaN(amount) || amount < 0) amount = 0;
      elAmount.value = amount > 0 ? fmt.format(amount) : '';
      // Loading state
      state.loading = !!showLoader;
      elLoading.style.display = state.loading ? 'block' : 'none';
      elResultMain.style.opacity = state.loading ? 0.45 : 1;
      elResultMain.style.transition = 'opacity 250ms';
      setTimeout(() => {
        const rate = getRate(state.from, state.to);
        let result = rate * amount;
        // Clamp to 2 decimals
        result = Math.round(result * 100) / 100;
        state.amount = amount;
        state.rate = rate;
        state.result = result;
        state.lastUpdated = state.lastUpdated || getNowTimestamp();
        // Render result
        elResultMain.innerHTML = `${fmt.format(result)}&nbsp;<span id='ccv-to-symbol'>${CCV_CURRENCIES[state.to].symbol}</span> <span id='ccv-to-flag' class='flag'>${CCV_CURRENCIES[state.to].flag}</span>`;
        elLoading.style.display = 'none';
        elResultMain.style.opacity = 1;
        updateFlags();
        elToSymbol.textContent = CCV_CURRENCIES[state.to].symbol;
        elToFlag.textContent = CCV_CURRENCIES[state.to].flag;
        elToFlagSelect.textContent = CCV_CURRENCIES[state.to].flag;
        // Show exchange rate row
        elRateRow.innerHTML = `1 ${state.from} = ${fmt.format(rate)} ${state.to} <span class='ccv-rate-timestamp'>Last updated: ${state.lastUpdated}</span>`;
        // History
        if (recordHistory && amount > 0) {
          addHistory({amount, from: state.from, to: state.to, result, timestamp: getNowTimestamp()});
        }
      }, state.loading ? 320 : 0); // Animate for 320ms if needed
    }
    // --- History logic ---
    function addHistory(entry) {
      // Don't add duplicate immediate repeat
      if (state.history[0] && JSON.stringify(state.history[0].slice ? state.history[0].slice(0,4) : state.history[0]) === JSON.stringify([entry.amount, entry.from, entry.to, entry.result])) return;
      // Keep last 5 only
      state.history.unshift(entry);
      if (state.history.length > 5) state.history = state.history.slice(0,5);
      renderHistory();
    }
    function renderHistory() {
      // Remove all except label
      elHistory.innerHTML = `<div class='ccv-history-item ccv-history-label' role='presentation'><div>Amount</div><div>From</div><div>To</div><div>Result</div><div style='font-size:11px; text-align:right;'>Time</div></div>`;
      state.history.forEach((h, i) => {
        const row = document.createElement('div');
        row.className = 'ccv-history-item';
        row.setAttribute('tabindex','0');
        row.setAttribute('title','Use this conversion');
        row.innerHTML = `<div>${fmt.format(h.amount)}</div><div>${CCV_CURRENCIES[h.from].flag}&nbsp;${h.from}</div><div>${CCV_CURRENCIES[h.to].flag}&nbsp;${h.to}</div><div>${fmt.format(h.result)}&nbsp;${CCV_CURRENCIES[h.to].symbol}</div><div style='font-size:10px;text-align:right;'>${h.timestamp}</div>`;
        row.onclick = row.onkeypress = (e) => {
          if (e.key && e.key !== 'Enter') return;
          elAmount.value = h.amount;
          elFrom.value = h.from;
          elTo.value = h.to;
          state.from = h.from; state.to = h.to;
          updateFlags();
          doConvert({ showLoader:true, recordHistory:false });
        };
        elHistory.appendChild(row);
      });
      if (state.history.length === 0) {
        const row = document.createElement('div');
        row.className = 'ccv-history-item';
        row.innerHTML = `<div style='grid-column:1/6;color:var(--color-text-secondary);text-align:center;'>&mdash; No conversion history yet &mdash;</div>`;
        elHistory.appendChild(row);
      }
    }
    // --- Input event bindings ---
    elAmount.addEventListener('input', () => {
      let val = elAmount.value.replace(/,/g,'');
      if (isNaN(+val) || +val<0) elAmount.value = '';
      else elAmount.value = val;
      doConvert({ showLoader:true, recordHistory:true });
    });
    elAmount.addEventListener('focus', () => elAmount.select());
    elAmount.addEventListener('keypress', (ev) => {
      if (ev.key === 'Enter' && +elAmount.value > 0) {
        doConvert({ showLoader:true, recordHistory:true });
      }
    });
    function onFromChange(ev) {
      state.from = ev.target.value;
      updateFlags();
      doConvert({ showLoader:true, recordHistory:true });
    }
    function onToChange(ev) {
      state.to = ev.target.value;
      updateFlags();
      doConvert({ showLoader:true, recordHistory:true });
    }
    renderCurrencySelect(elFrom, state.from, onFromChange, true);
    renderCurrencySelect(elTo, state.to, onToChange, true);
    // --- Swap logic ---
    elSwap.onclick = () => {
      [state.from, state.to] = [state.to, state.from];
      elFrom.value = state.from;
      elTo.value = state.to;
      updateFlags();
      doConvert({ showLoader:true, recordHistory:true });
    };
    // Copy-to-clipboard
    elCopyBtn.onclick = () => {
      const amount = state.result;
      if (typeof amount !== 'number') return;
      navigator.clipboard.writeText(fmt.format(amount));
      elCopyBtn.innerHTML = '<span style="color:var(--color-success);">&#10003; Copied</span>';
      setTimeout(() => {
        elCopyBtn.innerHTML = `<svg width='18' height='18' aria-hidden='true' viewBox='0 0 16 16' fill='none'><rect x='3.5' y='3.5' width='9' height='9' rx='2.5' stroke='currentColor'/><path d='M2.5 6V4A1.5 1.5 0 0 1 4 2.5h2' stroke='currentColor' stroke-linecap='round'/></svg>`;
      }, 900);
    };
    // --- History clear ---
    elHistoryClear.onclick = () => { state.history = []; renderHistory(); };
    // --- Initial render ---
    updateFlags();
    state.lastUpdated = getNowTimestamp();
    doConvert({ showLoader:false, recordHistory:false });
    renderHistory();
  </script>
</body>
</html>
